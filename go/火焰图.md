# 火焰图
火焰图是对程序CPU，内存等分析的可视化，火焰图是基于 perf 结果产生的SVG，因为使用暖色调，外形像一团火焰所以叫火焰图。
perf 命令（performance 的缩写）讲起，它是 Linux 系统原生提供的性能分析工具，会返回 CPU 正在执行的函数名以及调用栈（stack）
https://queue.acm.org/downloads/2016/Gregg4.svg
![火焰图](http://deliveryimages.acm.org/10.1145/2930000/2927301/gregg4.png)
**火焰图就是看顶层的哪个函数占据的宽度最大。只要有"平顶"（plateaus），就表示该函数可能存在性能问题。**

## 火焰图解释
火焰图显示了堆栈轨迹（又名调用堆栈）的集合，显示为具有倒置冰柱布局的邻接图。7火焰图通常用于可视化CPU分析器输出，其中使用采样来收集堆栈跟踪。

火焰图具有以下特征：

•堆栈跟踪表示为一列框，其中每个框表示一个功能（堆栈框架）。

•y轴显示堆栈深度，从底部到顶部的叶子排序。上面的框显示了当堆栈跟踪被收集时在CPU上的功能，并且它下面的所有东西都是它的祖先。函数下面的函数是它的父类。

•x轴跨越堆栈跟踪集合。它没有显示时间的流逝，所以从左到右的顺序没有特别的意义。堆栈跟踪从左到右排序是按照字母顺序从每个堆栈的根节点到叶节点的函数名称执行的。这最大化箱子合并：当相同的功能箱子水平地相邻时，它们被合并。

•每个函数框的宽度显示堆栈跟踪中存在该函数的频率，或堆栈跟踪系统的一部分。宽盒子的功能比窄盒子中的功能更多，与宽度成比例。

•如果框的宽度足够，则显示完整的功能名称。如果不是，则显示带有省略号的截断函数名称，或者不显示任何内容。

•每个框的背景颜色不重要，随机挑选为温暖的色调。这种随机性有助于眼睛区分盒子，特别是对于相邻的薄“塔”。其他配色方案稍后讨论。

•可视化的配置文件可能跨越单个线程，多个线程，多个应用程序或多个主机。如果需要，可以生成单独的火焰图形，特别是用于研究单个螺纹。

堆栈轨迹可以从不同的剖析器目标收集，宽度可以反映样本计数以外的其他度量。例如，分析器（或跟踪器）可以测量线程被阻塞的时间以及其堆栈跟踪。这可以被看作一个火焰图，其中x轴跨越总阻塞时间，火焰图显示阻塞代码路径。

由于整个剖析器输出一次可视化，最终用户可以直观地浏览到感兴趣的区域。火焰图中的形状和位置成为执行软件的可视化图。

虽然火焰图使用交互性来提供附加功能，但这些特性是通过静态火焰图来实现的，可以将其作为图像共享（例如PNG文件或打印在纸上）。虽然只有宽方框有足够的空间来容纳功能标签的文本，他们也足以显示配置文件的大部分。

### 交互

火焰图可以支持交互式功能，以显示更多细节，改进导航并执行计算。

原始的火焰图4的实现创建了一个带有嵌入式JavaScript的SVG图像用于交互，然后加载到浏览器中。它支持三种交互功能：鼠标悬停信息，点击放大和搜索。

#### 鼠标悬停信息

当鼠标悬停在框上时，火焰图下方的信息行和工具提示将显示完整的功能名称，配置文件中存在的样本数量以及配置文件中这些样本的相应百分比。例如`Function: mysqld'JOIN::exec`（272,959个样本，78.34％）。

这对于从未标记的框中显示函数名是有用的。该百分比还可以量化配置文件中的代码路径，从而帮助用户优先考虑潜在客户并根据提议的更改来估计改进。

#### 点击放大

点击一个盒子时，火焰图形会水平放大。这揭示了更多的细节，并经常为子函数的函数名称。单击框下方的祖先框架显示为带有褪色背景的视觉线索，其宽度现在仅部分显示。包含重置缩放按钮以返回到原始的完整配置文件视图。在缩放时单击任意框将重置缩放以聚焦在新框中。

#### 搜索

搜索按钮或按键（Ctrl-F）提示用户输入搜索词，其中可以包含正则表达式。在配置文件中的所有功能名称都被搜索，任何匹配的框都以洋红色背景突出显示。匹配堆栈轨迹的总和也显示在火焰图上，占总轮廓的百分比

原文：https://queue.acm.org/detail.cfm?id=2927301