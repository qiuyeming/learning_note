# 定义  (来源：维基百科)
在程序设计中，句柄（handle）是Windows操作系统用来标识被应用程序所创建或使用的对象的整数。其本质相当于带有引用计数的智能指针。当一个应用程序要引用其他系统（如数据库、操作系统）所管理的内存块或对象时，可以使用句柄。

# 句柄和指针
句柄与普通指针的区别在于，指针包含的是引用对象的内存地址，而句柄则是由系统所管理的引用标识，该标识可以被系统重新定位到一个内存地址上。这种间接访问对象的模式增强了系统对引用对象的控制。（参见封装）。通俗的说就是我们调用句柄就是调用句柄所提供的服务，即句柄已经把它能做的操作都设定好了，我们只能在句柄所提供的操作范围内进行操作，但是普通指针的操作却多种多样，不受限制。

# 句柄与安全性
客户获得句柄时，句柄不仅是资源的标识符，也被授予了对资源的特定访问权限。

# 句柄与操作系统
在上世纪80年代的操作系统（如Mac OS[1]和Windows）的内存管理中，句柄被广泛应用。Unix系统的文件描述符基本上也属于句柄。和其它桌面环境一样，Windows API大量使用句柄来标识系统中的对象，并创建操作系统与用户空间之间的通信渠道。例如，桌面上的一个窗体由一个HWND类型的句柄来标识。
如今，内存容量的增大和虚拟内存算法使得更简单的指针愈加受到青睐，而指向另一指针的那类句柄受到冷淡。尽管如此，许多操作系统仍然把指向私有对象的指针以及进程传递给客户端的内部数组下标称为句柄。

# Windows句柄的本质
内核对象是内存中的数据结构，由操作系统内核分配，并且只能由操作系统内核访问。内核对象的数据结构使用引用计数，计数变为0后操作系统内核就会销毁该内核对象。安全描述符（SECURITY_ATTRIBUTES结构）描述内核对象的安全性，指出内核对象的拥有者、哪些组或用户可以访问此对象。作为对照，用户对象或GDI对象（如菜单、窗口、鼠标光标等）在创建时不需要指出安全描述符。[2]
操作系统内核中有一个全局句柄表。每个进程有自己的一个句柄表，是一个数据结构组成的数组，每个数据结构包含一个指向内核对象的指针、访问掩码、继承标识等。句柄是进程句柄表数组的下标。在32位系统中，句柄是一个32位值。64位系统中则是64位值。应用程序调用创建内核对象的API函数后，该API函数会返回一个句柄以标识操作系统内核所创建的内核对象。这个句柄可以由进程的任何线程使用。使用CloseHandle函数或者进程结束时，内核句柄表中相应项的计数值会被减1。
GetCurrentProcess函数返回当前进程的句柄，其值为-1；GetCurrentThread函数返回的句柄其值为-2。二者都是伪句柄，在进程的句柄表中没有这两项，仅代表当前进程和当前线程。
进程间共享内核对象有如下途径：
+ 父子进程间的句柄继承：在调用API函数来创建内核对象时，使用SECURITY_ATTRIBUTES结构来指出可以被继承。创建子进程时，所有被继承的句柄在子进程句柄表中的位置与在父进程中完全一样；内核对象的使用计数也会加1。
+ 命名对象：注意所有种类的内核对象使用同一个命名空间。
+ 复制对象句柄：使用DuplicateHandle函数